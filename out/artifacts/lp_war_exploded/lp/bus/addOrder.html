#@busCommon()
#define main()
#define css()
<link href="lp/bus/css/addOrder.css" media="all" rel="stylesheet"/>
#end
<form class="layui-form addForm content-box" action="busOrder/orderBus" method="post">
<div class="left">
    <div class="info-out">
        <div class="info">
            <div class="rout-box">
                <input class="search-input" id="start" name="aza204" placeholder="请输入起点..." value=""/>
                <input class="search-input" id="endPoint" name="aza205" placeholder="请输入终点..." value=""/>
                <a class="btn btn_yes" id="confirm_point">确定</a>
                <div class="gap"></div>
            </div>
            <div class="other-info">
                <p>
                    <span>出发时间</span>
                    <input class="input-panel" id="time" name="aba032" readonly/>
                </p>
                <p>
                    <span>备注信息</span>
                    <textarea class="layui-textarea textarea" name="aaa999" maxlength="300"></textarea>
                </p>
            </div>
            <div class="choose-box" id="vehicle_box">
                <a class="btn btn-choose" id="choose_bus">点击选择车辆</a>
                <!--<div class="vehicle-info-box" id="vehicle" vehicle_id="">
                    <img class="vehicle-img" src="lp/bus/img/vehicle.jpg"/>
                    <p>车辆类型：<span>大巴车</span></p>
                    <p>荷载人数：<span>45人</span></p>
                    <p>车牌号：<span>川A 45V67</span></p>
                    <p>基础价格：<span>￥100.00元</span></p>
                    <div class="gap"></div>
                </div>-->
            </div>
            <div class="choose-box" id="driver-box">
                <a class="btn btn-choose" id="choose_driver">点击选择驾驶员</a>
                <!--<div class="vehicle-info-box" id="dirver">
                    &lt;!&ndash;                <img src="lp/bus/img/vehicle.jpg" class="vehicle-img" />&ndash;&gt;
                    <p>姓名：<span>驾驶员A</span></p>
                    <p>联系电话：<span>12345678910</span></p>
                    <p>服务星级：<span id="rate-panel">*****</span></p>
                    <div class="gap"></div>
                </div>-->
            </div>
        </div>
    </div>
    <div class="btn-box">
        <button class="btn btn-confirm">确定</button>
        <button class="btn btn-back">返回</button>
    </div>
</div>
<div id="container-none"></div>
<div id="container"></div>
</form>
<script charset="utf-8"
        src="https://map.qq.com/api/js?v=2.exp&key=ZHLBZ-IUWCK-GIUJ2-AQQHR-KLO7S-6NFCR&libraries=place,tools"></script>
<script charset="utf-8" src="https://map.qq.com/api/gljs?v=1.exp&key=ZHLBZ-IUWCK-GIUJ2-AQQHR-KLO7S-6NFCR"></script>
<script charset="UTF-8" src="lp/bus/js/add_order_map.js"></script>
<script>
    let startPoiList = null, startIndex = null;
    let endPoiList = null, endIndex = null;
    let vehicle_id, driver_id;
    layui.use(['layer', 'rate', 'laydate'], function () {
        let layer = layui.layer;
        let rate = layui.rate;
        let laydate = layui.laydate;
        init();
        laydate.render({
            elem: "#time"
            , type: "datetime"
            , min: 0
            , format: 'yyyy-MM-dd HH:mm'
            // , range: " ~ "
        });
        //渲染
        var ins1 = rate.render({
            elem: '#rate-panel'  //绑定元素
            , value: 5
            , readonly: true
        });
        $("#choose_bus").bind('click', function () {
            layer.open({
                type: 2
                , title: '选择车辆'
                , content: 'busOrder/toBusChoose'
                //,area:['1360px','870px']
                , area: ['95%', '95%']
                , shade: .3
                , end: function () {

                }
            });
        });
        $("#choose_driver").bind('click', function () {
            layer.open({
                type: 2
                , title: '选择驾驶员'
                , content: 'busOrder/toDriverChoose'
                // ,area:['1400px','850px']
                , area: ['95%', '95%']
                , shade: .3
                , end: function () {

                }
            });
        });
        $(".btn-back").bind('click', function () {
            history.go(-1);
        });
        $(".btn-confirm").bind('click', function () {
            //TODO 提交申请
        });
    });
    $(".btn_yes").bind('click', function () {
        if (isEmpty($("#start").val()) || isEmpty(startPoiList) || isEmpty(startPoiList[startIndex])) {
            //layer.msg('请输入并选择起点', {icon: 5,shade:.5,time: 2000});
            layer.tips('请输入并选择起点', '#start', {
                tips: 3
            });
            return false;
        }
        if (isEmpty($("#endPoint").val()) || isEmpty(endPoiList) || isEmpty(endPoiList[endIndex])) {
            //layer.msg('请输入并选择终点', {icon: 5,shade:.5,time: 2000});
            layer.tips('请输入并选择终点', '#endPoint', {
                tips: 3
            });
            return false;
        }
        //显示线路 里程和大致时间
        displayRout();
    });

    //设置被选择的车辆ID
    function setVehicleId(id) {
        let loadLayer = layer.load(2, {shade: .5});
        $("#vehicle").remove();
        //$("#vehicle").siblings('.gap').remove();
        $.ajax({
            url: 'busOrder/getAllBus'
            , type: 'get'
            , data: {'aaa001': id}
            , success: function (res) {
                let data = res.data[0];
                let html =
                    '<div class="vehicle-info-box" id="vehicle" vehicle_id="' + data.aaa001 + '">' +
                    '    <img class="vehicle-img" src="' + data.aaa009 + '"/>' +
                    '    <p>车辆类型：<span>' + data.type_desc + '</span></p>' +
                    '    <p>荷载人数：<span>' + data.aaa007 + '人</span></p>' +
                    '    <p>车牌号：<span>' + data.aaa005 + '</span></p>' +
                    '    <p>基础价格：<span>￥' + (isNotEmpty(data.aza001) ? data.aza001 : '0.00') + '元</span></p>' +
                    '    <div class="gap"></div>' +
                    '</div>';
                $("#vehicle_box").append(html);
                layer.close(loadLayer);
            }
            , error: function (res) {
                layer.close(loadLayer);
            }
        });
    }

    //设置被选择的司机ID
    function setDriverId(id) {
        let loadLayer = layer.load(2, {shade: .5});
        $("#driver").remove();
        $.ajax({
            url: 'busWx/getBusAa02All'
            , type: 'get'
            , data: {'aaa020': id}
            , success: function (res) {
                let data = res[0];
                let html =
                    '<div class="vehicle-info-box" id="driver">' +
                    '    <p>姓名：<span>' + data.aaa002 + '</span></p>' +
                    '    <p>联系电话：<span>' + data.aaa007 + '</span></p>' +
                    '    <p>服务星级：<span id="rate-panel">*****</span></p>' +
                    '    <div class="gap"></div>' +
                    '</div>';
                $("#driver-box").append(html);
                layer.close(loadLayer);
            }
            , error: function (res) {
                layer.close(loadLayer);
            }
        });
    }

</script>
#end
