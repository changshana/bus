#@busCommon()

#define css()
<style>
    body{
        padding: 0;
        margin: 0;
        background-color: #F5F6FA;
        height: auto;
    }
    .content{
        width: 98%;
        margin: 0 auto;
        height: auto;
        padding: 20px 0;
    }
    .item-top{
        width: 100%;
        height: 500px;
        background-color: #FFFFFF;
        border-radius: 3px;
    }
    .item-bottom{
        margin-top: 20px;
        width: 100%;
        height: 500px;
    }
    .left{
        width: 49.5%;
        height: 100%;
        float: left;
        background-color: #FFFFFF;
        border-radius: 3px;
    }
    .right{
        width: 49.5%;
        height: 100%;
        float: right;
        background-color: #FFFFFF;
        border-radius: 3px;
    }
    .toolbar{
        height: 80px;
        width: 100%;
        position: relative;
        padding-top: 21px;
    }
    .title-container{
        width: auto;
        height: 38px;
        line-height: 38px;
        float: left;
    }
    .title{
        height: 20px;
        line-height: 20px;
        width: auto;
        border-left:5px solid #009788;
        text-indent: 2em;
        color: #333333;
        font-weight: 600;
        font-size: 18px;
        margin-top: 9px;
    }
    .clear{
        clear: both;
    }
    .chart-container{
        width: 100%;
        height: 420px;
    }
    .select{
        float: right;
        clear: none;
        margin-right: 4em;
        border-radius: 4px;
    }
    .layui-btn-group{
        margin-left: 30px;
        border: 1px solid #CED1DA;
        margin-top: 1px;
    }
    .layui-btn-group .btn{
        height: 36px;
        line-height: 36px;
        background-color: #FFFFFF;
        color: #333;
        border: none;
    }
    .btn-checked{
        background-color: #009788!important;
        color: #ffffff!important;
    }
    .satisfy-container,.item-container{
        width: 90%;
        margin: 0 auto;
        height: auto;
    }
    .satisfy-container .item{
        height: 80px;
        width: 100%;
    }
    .satisfy-container .item .item-title{
        height: 40px;
        line-height: 40px;
        text-indent: 1em;
        font-size: 16px;
        font-weight: 600;
    }
    .layui-progress {
        position: relative;
        height: 18px;
        border-radius: 20px;
        background-color: #E2E7ED;
    }
    .layui-bg-green {
        background-color: #009788 !important;
    }
    .item-container>div{
        float: left;
    }
    .item-container .item{
        width: 30%;
        height: 320px;
        margin: 40px 1%;
        border: 1px solid #E6E9EE;
        border-radius: 3px;
    }
    .item-t{
        height: 220px;
        width: 100%;
        background-color: #FFFFFF;
        border-bottom: 1px solid #E6E9EE;
        padding-top: 30px;
    }
    .item-b{
        height: 69px;
        line-height: 69px;
        width: 100%;
        background-color: #F4F8FB;
        text-align: center;
        font-size: 16px;
        color: #333;
        font-weight: 600;
        border-radius:0 0 3px 3px;
        letter-spacing: 3px;
    }
    .percent{
        width: 120px;
        border: 7px solid #E8F0F2;
        height: 120px;
        border-radius: 120px;
        margin: 0 auto;
        line-height: 120px;
        text-align: center;
        font-size: 22px;
    }
    .count{
        height: 50px;
        line-height: 50px;
        text-align: center;
        font-size: 24px;
    }
    .bks{
        color: #2087E3;
    }
    .yjs{
        color: #F0A808;
    }
    .jzg{
        color: #F15352;
    }
    .datePicker{
        width: 200px;
        height: 38px;
        border: 1px solid;
        float: right;
        clear: none;
        margin-right: 4em;
        border-radius: 4px;
        line-height: 38px;
        text-align: center;
        cursor: pointer;
    }
    .dateArea{
        width: 200px;
        height: 38px;
        border: 1px solid;
        clear: none;
        margin-right: 4em;
        border-radius: 4px;
        line-height: 38px;
        text-align: center;
        cursor: pointer;
        display: inline-block;
        position: absolute;
        right: 240px;
    }
    .layui-btn-group{
        position: absolute;
        right: 4rem;
    }
</style>
#end
#define main()
<form class="layui-form">
<div class="content">
    <div class="item-top">
        <div class="toolbar">
            <div class="title-container">
                <p class="title">校车发车情况统计</p>
            </div>
            <a id="dateArea" class="dateArea"></a>
            <div class="layui-form-item select">
                <div class="layui-input-inline">
                    <select class="select layui-form-item" id="aa020" lay-filter="aa020">
                        <option value="0">全部司机</option>
                        #for(aa02:aa02List)
                        <option value="#(aa02.id)">#(aa02.name)</option>
                        #end
                    </select>
                </div>
            </div>
        </div>
        <div class="chart-container" id="dispatch">

        </div>
    </div>
    <div class="item-bottom">
        <div class="left">
            <div class="toolbar">
                <div class="title-container">
                    <p class="title">满意度调查统计</p>
                </div>
                <div class="layui-btn-group" id="aca033">
                    #for(aca033:aca033List)
                    <a aca033="#(aca033.id)" class="layui-btn btn">#(aca033.name)</a>
                    #end
                </div>
                <!--<div class="layui-form-item select">
                    <div class="layui-input-inline">
                        <select class="select layui-form-item" id="driver" lay-filter="driver">
                            <option value="0">全部司机</option>
                            #for(aa02:aa02List)
                            <option value="#(aa02.id)">#(aa02.name)</option>
                            #end
                        </select>
                    </div>
                </div>-->
            </div>
            <div class="satisfy-container">

            </div>
        </div>
        <div class="right">
            <div class="toolbar">
                <div class="title-container">
                    <p class="title">预约人数统计</p>
                </div>
                <a id="datePicker" class="datePicker"></a>
            </div>
            <div class="item-container">

            </div>
        </div>
    </div>
</div>
</form>
<script type="text/javascript">
    var form,element;
    layui.use(['layer','form','element','laydate'],function(){
        var $=layui.$,layer=layui.layer,laydate=layui.laydate;
        element=layui.element,form=layui.form;
        getData();
        $(".layui-btn-group .btn").click(function(){
            $(".layui-btn-group .btn").removeClass("btn-checked");
            $(this).addClass("btn-checked");
            generateAca033($(this).attr('aca033'));
        });
        $(".layui-btn-group .btn").eq(0).click();
        laydate.render({
            elem:"#datePicker"
            ,format:'yyyy-MM-dd'
            ,range: "~"
            ,btns:["confirm"]
            ,max:0
            ,done:function (val) {
                generateCa03List(val);
            }
        });
        laydate.render({
            elem:"#dateArea"
            ,format:'yyyy-MM-dd'
            ,range: "~"
            ,btns:["confirm"]
            ,max:0
            ,done:function (val) {
                getData($("#aa020").val(),val);
            }
        });
        form.on('select(aa020)',function(data){
            getData(data.value,$("#dateArea").html());
        });
        generateCa03List();
    });
    function getData(aaa020,dateArea){
        $.ajax({
            type:'post'
            ,url:'bus/getBusStatisticData'
            ,data:{"aaa020":$("#aa020").val(),"dateArea":dateArea}
            ,success:function(res){
                $("#dateArea").html(res.dateArea);
                var ca05XData=[];
                var ca05SeriesData=[];
                $.each(res.ca05List,function(i,item){
                    ca05XData.push(item.date);
                    ca05SeriesData.push(item.count);
                });
                generateChart('dispatch',ca05XData,ca05SeriesData);
            }
            ,error:function(){

            }
        });
    }
    function generateAca033(aca033){
        $(".satisfy-container").empty();
        $.ajax({
            type:'post'
            ,url:'bus/getAca033List'
            ,data:{"aca033":aca033}
            ,success:function(res){
                $.each(res,function(i,item){
                    var li='<div class="item">' +
                        ' <p class="item-title">'+item.name+'</p>' +
                        ' <div class="layui-progress layui-progress-big" lay-showPercent="yes">' +
                        ' <div class="layui-progress-bar layui-bg-green" lay-percent="'+item.per+'%">'+item.per+'%</div>' +
                        ' </div>' +
                        ' </div>';
                    $(".satisfy-container").append(li);
                });
                element.render('progress');
            }
            ,error:function(){

            }
        });
    }
    function generateCa03List(date){
        $.ajax({
            type:'post'
            ,url:'bus/getCa03List'
            ,data:{"dateArea":date}
            ,success:function(res){
                console.log(res);
                var itemhtml='';
                $(".item-container").empty();
                $("#datePicker").html(res.dateArea);
                $.each(res.ca03List,function(i,item){
                    if(item.aca044==1){
                        itemhtml=
                            '<div class="item bks">' +
                            '<div class="item-t">' +
                            '<div class="percent bks">'+item.per+'%</div>' +
                            '<p class="count">'+item.count+'人次</p>' +
                            '</div>' +
                            '<p class="item-b">'+item.name+'</p>' +
                            '</div>';
                    }else if(item.aca044==2){
                        itemhtml=
                            '<div class="item yjs">' +
                            '<div class="item-t">' +
                            '<div class="percent yjs">'+item.per+'%</div>' +
                            '<p class="count">'+item.count+'人次</p>' +
                            '</div>' +
                            '<p class="item-b">'+item.name+'</p>' +
                            '</div>';
                    }else if(item.aca044==3){
                        itemhtml=
                            '<div class="item jzg">' +
                            '<div class="item-t">' +
                            '<div class="percent jzg">'+item.per+'%</div>' +
                            '<p class="count">'+item.count+'人次</p>' +
                            '</div>' +
                            '<p class="item-b">'+item.name+'</p>' +
                            '</div>';
                    }
                    $(".item-container").append(itemhtml);
                });
            }
            ,error:function(){

            }
        });
    }
    function generateChart(elem,xData,sData){
        var myChart = echarts.init(document.getElementById(elem));
        // 指定图表的配置项和数据
        option = {
            xAxis: {
                type: 'category',
                boundaryGap: false,
                data: xData
            },
            yAxis: {
                type: 'value'
            },
            tooltip:{
                trigger:'axis'
                ,formatter: '{b0}<br />发车： {c0} 班次'
            },
            series: [{
                data: sData,
                type: 'line',
                symbolSize:8,
                color:['#1F96F0'],
                areaStyle: {
                    color:'#F5FAFE'
                }
                /*,itemStyle : {
                    normal : {
                        lineStyle:{
                            color:'#1F96F0'
                        }
                    }
                },*/
            }]
        };
        // 使用刚指定的配置项和数据显示图表。
        myChart.setOption(option);
    }
</script>
#end
